# Agent Selector Implementation

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å–µ–ª–µ–∫—Ç–æ—Ä –∞–≥–µ–Ω—Ç–æ–≤ (Agent Selector) –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–æ–≤ –≤ RooCode.

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. AgentSelector Component

**–§–∞–π–ª:** `webview/src/components/AgentSelector.tsx`

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∞–≥–µ–Ω—Ç–∞:

- **–ü–æ–∑–∏—Ü–∏—è:** –ü–æ–¥ –ø–æ–ª–µ–º –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
  - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
  - –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
  - –û–ø—Ü–∏—è "Auto" –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞ –∞–≥–µ–Ω—Ç–∞
  - –ò–∫–æ–Ω–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∞–≥–µ–Ω—Ç–∞
  - –û–ø–∏—Å–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤
  - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ (–≥–∞–ª–æ—á–∫–∞)

**–ò–∫–æ–Ω–∫–∏ –ø–æ —Ç–∏–ø–∞–º –∞–≥–µ–Ω—Ç–æ–≤:**
- `architect`: üèóÔ∏è
- `code`: üíª
- `ask`: ‚ùì
- `debug`: ü™≤
- `orchestrator`: ü™É
- `default`: ü§ñ

### 2. –°—Ç–∏–ª–∏

**–§–∞–π–ª:** `webview/src/components/AgentSelector.module.css`

–°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º VSCode theme variables:
- Dropdown –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö (–Ω–∞–¥ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º)
- –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
- Hover —ç—Ñ—Ñ–µ–∫—Ç—ã
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ–º–Ω–æ–π/—Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã VSCode

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ ChatInput

**–§–∞–π–ª:** `webview/src/components/ChatInput.tsx`

–û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏–π:
- –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –∞–≥–µ–Ω—Ç–æ–≤ –ø–æ–¥ –ø–æ–ª–µ–º –≤–≤–æ–¥–∞
- –ü–µ—Ä–µ–¥–∞—á–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- Props –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–æ–º –∞–≥–µ–Ω—Ç–æ–≤ –∏ –≤—ã–±–æ—Ä–æ–º

**–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [üìé] [Textarea...] [‚û§]        ‚îÇ  ‚Üê Input Area
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  [ü§ñ Auto ‚ñº]                    ‚îÇ  ‚Üê Agent Selector
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

### Agent Interface

**–§–∞–π–ª:** `webview/src/types/index.ts`

```typescript
export interface Agent {
  id: string;
  name: string;
  type: string;
  icon?: string;
  description?: string;
  config?: Record<string, any>;
  created_at?: string;
}
```

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π

**MessageToExtension:**
- –î–æ–±–∞–≤–ª–µ–Ω —Ç–∏–ø `'loadAgents'`
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `targetAgent?: string`

**MessageFromExtension:**
- –î–æ–±–∞–≤–ª–µ–Ω —Ç–∏–ø `'agentsLoaded'`

## Backend Integration

### API Client

**–§–∞–π–ª:** `src/api/client.ts`

–£–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–≥–µ–Ω—Ç–∞–º–∏:
- `listAgents()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–≥–µ–Ω—Ç–æ–≤
- `getAgent(agentId)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
- `createAgent(config)` - —Å–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞
- `updateAgent(agentId, config)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞
- `deleteAgent(agentId)` - —É–¥–∞–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞

### CodeLabAPI

**–§–∞–π–ª:** `src/api/index.ts`

–û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `sendMessage`:
```typescript
async sendMessage(content: string, targetAgent?: string): Promise<void>
```

–î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥:
```typescript
async listAgents(): Promise<AgentListResponse>
```

### ChatViewProvider

**–§–∞–π–ª:** `src/ui/ChatViewProvider.ts`

–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞:
- `case 'loadAgents'` - –∑–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∞–≥–µ–Ω—Ç–æ–≤
- `case 'sendMessage'` - –ø–µ—Ä–µ–¥–∞—á–∞ `targetAgent` –≤ API
- –ú–µ—Ç–æ–¥ `loadAgents()` - –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–ø–∏—Å–∫–∞ –∞–≥–µ–Ω—Ç–æ–≤ –≤ webview

## –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

### –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≥–µ–Ω—Ç–æ–≤

```
1. App.tsx (mount) 
   ‚Üí postMessage({ type: 'loadAgents' })

2. ChatViewProvider 
   ‚Üí api.listAgents()

3. APIClient 
   ‚Üí GET /my/agents/

4. ChatViewProvider 
   ‚Üí postMessage({ type: 'agentsLoaded', payload: { agents } })

5. App.tsx 
   ‚Üí setAgents(agents)
   ‚Üí –ø–µ—Ä–µ–¥–∞—á–∞ –≤ ChatInput
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∞–≥–µ–Ω—Ç–æ–º

```
1. User –≤—ã–±–∏—Ä–∞–µ—Ç –∞–≥–µ–Ω—Ç–∞ –≤ AgentSelector
   ‚Üí setSelectedAgent(agent)

2. User –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
   ‚Üí handleSendMessage(content, agent.id)

3. App.tsx 
   ‚Üí postMessage({ type: 'sendMessage', content, targetAgent })

4. ChatViewProvider 
   ‚Üí api.sendMessage(content, targetAgent)

5. APIClient 
   ‚Üí POST /sessions/{id}/messages/
   ‚Üí body: { content, target_agent, context }
```

## –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤ App

**–§–∞–π–ª:** `webview/src/App.tsx`

–î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
```typescript
const [agents, setAgents] = useState<Agent[]>([]);
const [selectedAgent, setSelectedAgent] = useState<Agent | null>(null);
```

–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π:
```typescript
case 'agentsLoaded':
  state.setAgents(message.payload.agents || []);
  break;
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. –û—Ç–∫—Ä—ã—Ç—å CodeLab Chat View
2. –ü–æ–¥ –ø–æ–ª–µ–º –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å–µ–ª–µ–∫—Ç–æ—Ä –∞–≥–µ–Ω—Ç–∞
3. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–±—Ä–∞–Ω "Auto" (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä)
4. –ö–ª–∏–∫ –Ω–∞ —Å–µ–ª–µ–∫—Ç–æ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
5. –í—ã–±–æ—Ä –∞–≥–µ–Ω—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
6. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è - –æ–Ω–æ –±—É–¥–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –∞–≥–µ–Ω—Ç—É

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –∞–≥–µ–Ω—Ç–∞ —Å –∏–∫–æ–Ω–∫–æ–π:

```typescript
// –í AgentSelector.tsx
const iconMap: Record<string, string> = {
  'architect': 'üèóÔ∏è',
  'code': 'üíª',
  'new_type': 'üé®',  // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∏–ø
  // ...
};
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **Dropdown –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤–≤–µ—Ä—Ö (–Ω–∞–¥ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º), —Ç–∞–∫ –∫–∞–∫ —Å–µ–ª–µ–∫—Ç–æ—Ä –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞

2. **Auto —Ä–µ–∂–∏–º:** –ö–æ–≥–¥–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∞–≥–µ–Ω—Ç (`selectedAgent === null`), —Å–µ—Ä–≤–µ—Ä —Å–∞–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –∞–≥–µ–Ω—Ç–∞

3. **–ó–∞–∫—Ä—ã—Ç–∏–µ dropdown:** –ö–ª–∏–∫ –≤–Ω–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫

4. **–ê–Ω–∏–º–∞—Ü–∏—è:** –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ dropdown —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º slideUp

5. **Accessibility:** –î–æ–±–∞–≤–ª–µ–Ω—ã ARIA –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (F5)
2. –û—Ç–∫—Ä—ã—Ç—å CodeLab Chat View
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –∞–≥–µ–Ω—Ç–æ–≤ –ø–æ–¥ –ø–æ–ª–µ–º –≤–≤–æ–¥–∞
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Å–ø–∏—Å–∫–∞ –∞–≥–µ–Ω—Ç–æ–≤ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å –∫ API)
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–±–æ—Ä –∞–≥–µ–Ω—Ç–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–¥–∞—á—É `target_agent` –≤ API –∑–∞–ø—Ä–æ—Å–µ

## –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∞–≥–µ–Ω—Ç–æ–≤ –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
2. **–ò–∑–±—Ä–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã:** –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–º–µ—Ç–∏—Ç—å —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
3. **–ü–æ–∏—Å–∫:** –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∏—Å–∫ –ø–æ —Å–ø–∏—Å–∫—É –∞–≥–µ–Ω—Ç–æ–≤
4. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞:** –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –∞–≥–µ–Ω—Ç–æ–≤ –ø–æ —Ç–∏–ø–∞–º
5. **–°—Ç–∞—Ç—É—Å –∞–≥–µ–Ω—Ç–∞:** –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∞–≥–µ–Ω—Ç–∞ (–æ–Ω–ª–∞–π–Ω/–æ—Ñ–ª–∞–π–Ω)
6. **–ò—Å—Ç–æ—Ä–∏—è:** –ó–∞–ø–æ–º–∏–Ω–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –¥–ª—è —Å–µ—Å—Å–∏–∏
